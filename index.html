<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Spinner</title>
  <style>
    :root{
      --bg:#0f1226;
      --card:#15193a;
      --accent:#7c8cf8;
      --accent-2:#37e0b2;
      --text:#e8ecff;
      --muted:#aab1d6;
      --danger:#ff6b6b;
      --ok:#20c997;
      --shadow: 0 10px 30px rgba(0,0,0,.35), 0 0 60px rgba(124,140,248,.15);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(124,140,248,.20), transparent 60%),
        radial-gradient(1000px 500px at 120% 120%, rgba(55,224,178,.18), transparent 60%),
        var(--bg);
      color:var(--text);
      min-height:100svh; display:grid; place-items:center; padding:24px;
    }
    .app{width:min(960px, 100%);}

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)) , var(--card);
      border:1px solid rgba(255,255,255,.06);
      border-radius:20px; box-shadow:var(--shadow);
      padding:20px; backdrop-filter: blur(6px);
    }
    h1{
      margin:0 0 12px; font-size:clamp(20px, 2.6vw, 28px); font-weight:700; letter-spacing:.3px;
    }
    .sub{color:var(--muted); margin:0 0 20px; font-size:14px}

    .controls{
      display:grid; gap:12px; grid-template-columns: 1fr auto auto auto;
      align-items:end; margin-bottom:18px;
    }
    .field{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.07);
      padding:12px; border-radius:14px;
    }
    .field label{font-size:14px; color:var(--muted)}
    .field input[type="number"]{
      width:120px; appearance:textfield;
      background:#0e1130; color:var(--text); border:1px solid rgba(255,255,255,.12);
      padding:10px 12px; border-radius:10px; font-size:16px; outline:none;
      transition:border .2s, box-shadow .2s;
    }
    .field input[type="number"]:focus{border-color:var(--accent); box-shadow:0 0 0 4px rgba(124,140,248,.15)}
    .chk{
      display:flex; align-items:center; gap:8px; padding:10px 12px; border-radius:10px;
      border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.03);
    }
    .hint{font-size:12px; color:var(--muted)}

    button{
      appearance:none; border:none; cursor:pointer; border-radius:12px; padding:12px 18px; font-weight:600;
      background:linear-gradient(180deg, var(--accent), #6373ff); color:#0e1130;
      box-shadow:0 8px 20px rgba(124,140,248,.35); transition:transform .08s ease, filter .2s ease, opacity .2s ease;
    }
    button:hover{filter:saturate(1.05) brightness(1.05)}
    button:active{transform:translateY(1px)}
    button.secondary{
      background:linear-gradient(180deg, #2b2f57, #1c2046);
      color:var(--text); box-shadow:none; border:1px solid rgba(255,255,255,.08);
    }
    button.danger{
      background:linear-gradient(180deg, #ff8989, #ff6b6b); color:#2a0a0a;
      box-shadow:0 8px 20px rgba(255,107,107,.35);
    }
    button:disabled{opacity:.55; cursor:not-allowed; transform:none}

    .display{
      user-select:none;
      display:flex; align-items:center; justify-content:center;
      height:180px; border-radius:22px; margin:10px 0 16px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)),
        radial-gradient(120% 120% at 30% 5%, rgba(124,140,248,.1), transparent 60%),
        #0c0f2a;
      border:1px solid rgba(255,255,255,.08);
      box-shadow: inset 0 6px 20px rgba(0,0,0,.35), 0 6px 24px rgba(0,0,0,.35);
      position:relative; overflow:hidden;
    }
    .number{
      font-weight:800; letter-spacing:.8px;
      font-variant-numeric: tabular-nums;
      font-size: clamp(56px, 10vw, 96px);
      text-shadow: 0 6px 20px rgba(0,0,0,.35);
      transform:translateY(0);
      transition: transform .3s cubic-bezier(.2,.8,.2,1), filter .3s;
      filter: drop-shadow(0 0 14px rgba(124,140,248,.35));
    }
    .spinning .number{ animation: pulseBlur .25s linear infinite }
    @keyframes pulseBlur {
      0%{ filter: blur(0px) drop-shadow(0 0 10px rgba(124,140,248,.25))}
      50%{ filter: blur(2px) drop-shadow(0 0 16px rgba(124,140,248,.35))}
      100%{ filter: blur(0px) drop-shadow(0 0 10px rgba(124,140,248,.25))}
    }
    .badge{
      position:absolute; top:12px; right:12px; font-size:12px; padding:6px 10px; border-radius:999px;
      background:rgba(55,224,178,.12); color:var(--accent-2); border:1px solid rgba(55,224,178,.45);
    }
    .info{
      display:flex; flex-wrap:wrap; gap:8px; align-items:center; color:var(--muted); font-size:13px; margin-bottom:8px;
    }
    .dot{width:6px; height:6px; border-radius:99px; background:var(--accent-2); display:inline-block; margin-right:6px}
    .counter{padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08)}

    .history{
      display:flex; gap:8px; flex-wrap:wrap; padding:10px; min-height:44px;
      background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); border-radius:14px;
    }
    .pill{
      padding:6px 10px; border-radius:999px; background:linear-gradient(180deg, rgba(124,140,248,.15), rgba(124,140,248,.08));
      border:1px solid rgba(124,140,248,.35); font-weight:600; color:var(--text); font-size:13px;
    }
    .warn{color:var(--danger)}

    @media (max-width:640px){
      .controls{grid-template-columns: 1fr 1fr; grid-auto-rows: auto}
      .controls .buttons{grid-column: 1 / -1; display:flex; gap:10px; flex-wrap:wrap}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>Spinner Angka</h1>
      <p class="sub">Acak angka dari <strong>1</strong> sampai nilai maksimum yang kamu tentukan (min 1, max 2000). Opsional: hindari duplikasi.</p>

      <div class="controls">
        <div class="field" style="grid-column: 1 / span 1;">
          <label for="maxInput">Maksimum</label>
          <input id="maxInput" type="number" inputmode="numeric" min="1" max="2000" value="100" />
          <span class="hint">rentang: 1 … N</span>
        </div>

        <label class="chk">
          <input id="noRepeat" type="checkbox" />
          <span>Tanpa duplikasi</span>
        </label>

        <div class="buttons" style="display:flex; gap:10px;">
          <button id="spinBtn" aria-label="Mulai spin">Spin</button>
          <button id="stopBtn" class="secondary" disabled>Stop</button>
          <button id="resetBtn" class="danger" title="Hapus riwayat & duplikasi">Reset</button>
        </div>
      </div>

      <div id="display" class="display" aria-live="polite">
        <div class="badge">1 … <span id="maxBadge">100</span></div>
        <div id="number" class="number">—</div>
      </div>

      <div class="info">
        <span><span class="dot"></span><span id="statusText">Siap diacak.</span></span>
        <span class="counter" id="remainWrap" style="display:none;">Sisa unik: <strong id="remainCount">0</strong></span>
      </div>

      <div class="history" id="history" aria-label="Riwayat hasil"></div>
    </div>
  </div>

  <script>
    // ---- Utility ----
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    const maxInput    = $("#maxInput");
    const noRepeatCB  = $("#noRepeat");
    const spinBtn     = $("#spinBtn");
    const stopBtn     = $("#stopBtn");
    const resetBtn    = $("#resetBtn");
    const numberEl    = $("#number");
    const display     = $("#display");
    const maxBadge    = $("#maxBadge");
    const statusText  = $("#statusText");
    const historyBox  = $("#history");
    const remainWrap  = $("#remainWrap");
    const remainCount = $("#remainCount");

    let drawn = new Set();           // untuk mode tanpa duplikasi
    let spinning = false;
    let scheduledTimeouts = [];
    let finalResult = null;

    // Easing: easeOutCubic
    const easeOutCubic = t => 1 - Math.pow(1 - t, 3);

    function clampMax(v){
      if (isNaN(v)) v = 1;
      v = Math.floor(v);
      if (v < 1) v = 1;
      if (v > 2000) v = 2000;
      return v;
    }

    function updateMaxBadge(){
      const max = clampMax(+maxInput.value);
      maxBadge.textContent = String(max);
      updateRemain(max);
    }

    function updateRemain(max){
      if (!noRepeatCB.checked){
        remainWrap.style.display = "none";
        return;
      }
      // buang angka drawn yang > max
      drawn.forEach(n => { if (n > max) drawn.delete(n); });
      const remain = Math.max(0, max - drawn.size);
      remainWrap.style.display = "inline-flex";
      remainCount.textContent = remain;
    }

    function randomInt1N(n){
      return 1 + Math.floor(Math.random() * n);
    }

    function pickFinal(max, unique){
      if (!unique) return randomInt1N(max);
      if (drawn.size >= max) return null;
      // Pilih angka yang belum pernah keluar
      // Cara cepat saat rentang kecil (<=2000): buat daftar tersisa
      const available = [];
      for (let i=1;i<=max;i++) if (!drawn.has(i)) available.push(i);
      const idx = Math.floor(Math.random()*available.length);
      return available[idx];
    }

    function setStatus(msg, colorClass){
      statusText.textContent = msg;
      statusText.classList.toggle('warn', !!colorClass);
    }

    function addHistory(n){
      const pill = document.createElement('div');
      pill.className = 'pill';
      pill.textContent = n;
      historyBox.prepend(pill);
      // batasi 30 item agar ringan
      const pills = $$(".history .pill");
      if (pills.length > 30) pills.slice(30).forEach(p => p.remove());
    }

    function clearScheduled(){
      scheduledTimeouts.forEach(id => clearTimeout(id));
      scheduledTimeouts = [];
    }

    function setSpinningUI(isSpin){
      spinning = isSpin;
      display.classList.toggle("spinning", isSpin);
      spinBtn.disabled = isSpin;
      stopBtn.disabled = !isSpin;
      maxInput.disabled = isSpin;
      noRepeatCB.disabled = isSpin;
      resetBtn.disabled = isSpin;
    }

    function spin(){
      const max = clampMax(+maxInput.value);
      maxInput.value = max;
      updateMaxBadge();

      // Validasi mode unik
      if (noRepeatCB.checked && drawn.size >= max){
        setStatus("Semua angka sudah terambil. Tekan Reset untuk mulai ulang.", "warn");
        flashBorder(display, 'danger');
        return;
      }

      // Tentukan hasil akhir terlebih dahulu (agar Stop bisa langsung menuju hasil ini)
      finalResult = pickFinal(max, noRepeatCB.checked);
      if (finalResult === null){
        setStatus("Tidak ada angka tersisa.", "warn");
        return;
      }

      setSpinningUI(true);
      setStatus("Mengacak…");

      const duration = 1800;     // ms
      const steps = 45;          // jumlah update sebelum hasil akhir
      const start = performance.now();

      // Jadwalkan update angka dengan easing (melambat)
      clearScheduled();
      for (let i = 0; i < steps; i++){
        const t = i / (steps - 1);
        const when = start + easeOutCubic(t) * duration;
        const id = setTimeout(() => {
          numberEl.textContent = String(randomInt1N(max));
        }, Math.max(0, when - performance.now()));
        scheduledTimeouts.push(id);
      }

      // Tampilkan hasil final
      const endId = setTimeout(() => {
        clearScheduled();
        revealFinal(finalResult);
      }, duration + 30);
      scheduledTimeouts.push(endId);
    }

    function revealFinal(n){
      numberEl.textContent = String(n);
      numberEl.style.transform = 'translateY(-6px)';
      setTimeout(()=> numberEl.style.transform = 'translateY(0)', 160);

      addHistory(n);

      if (noRepeatCB.checked){
        drawn.add(n);
      }

      updateRemain(clampMax(+maxInput.value));
      setStatus("Selesai!");
      flashBorder(display, 'ok');

      setSpinningUI(false);
    }

    function stopEarly(){
      if (!spinning) return;
      clearScheduled();
      // Jika belum punya finalResult (seharusnya sudah ada), fallback angka random
      const max = clampMax(+maxInput.value);
      if (finalResult == null) finalResult = pickFinal(max, noRepeatCB.checked) ?? randomInt1N(max);
      revealFinal(finalResult);
    }

    function resetAll(){
      clearScheduled();
      setSpinningUI(false);
      drawn.clear();
      historyBox.innerHTML = "";
      numberEl.textContent = "—";
      updateRemain(clampMax(+maxInput.value));
      setStatus("Di-reset. Siap diacak lagi.");
      flashBorder(display, null);
    }

    function flashBorder(el, type){
      el.style.boxShadow = el.style.boxShadow; // trigger reflow
      el.style.outline = type === 'danger' ? '2px solid var(--danger)'
                      : type === 'ok'     ? '2px solid var(--accent-2)'
                                          : '1px solid rgba(255,255,255,.08)';
      // hilangkan highlight pelan
      setTimeout(()=>{ el.style.outline = '1px solid rgba(255,255,255,.08)'; }, 700);
    }

    // ---- Listeners ----
    spinBtn.addEventListener('click', spin);
    stopBtn.addEventListener('click', stopEarly);
    resetBtn.addEventListener('click', resetAll);

    maxInput.addEventListener('input', () => {
      const v = clampMax(+maxInput.value);
      // tidak langsung memaksa saat mengetik, tapi batasi jika lewat
      if (+maxInput.value > 2000) maxInput.value = 2000;
      if (+maxInput.value < 1 || !maxInput.value) maxInput.value = 1;
      updateMaxBadge();
      updateRemain(v);
      setStatus("Siap diacak.");
    });

    noRepeatCB.addEventListener('change', () => {
      updateRemain(clampMax(+maxInput.value));
      setStatus(noRepeatCB.checked ? "Mode tanpa duplikasi aktif." : "Mode tanpa duplikasi nonaktif.");
    });

    // Init
    updateMaxBadge();
    updateRemain(+maxInput.value);
  </script>
</body>
</html>
